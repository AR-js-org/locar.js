import{S as Y,V as Q,d as Z,E as K,b as g,e as z,R as $,f as B,Q as L}from"./three.module-YNhpf6Xm.js";var N=i=>{throw TypeError(i)},_=(i,t,e)=>t.has(i)||N("Cannot "+e),s=(i,t,e)=>(_(i,t,"read from private field"),e?e.call(i):t.get(i)),p=(i,t,e)=>t.has(i)?N("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),d=(i,t,e,n)=>(_(i,t,"write to private field"),t.set(i,e),e),w=(i,t,e)=>(_(i,t,"access private method"),e),J=(i,t,e,n)=>({set _(r){d(i,t,r)},get _(){return s(i,t,n)}}),C,G,V,X,U;class tt{constructor(){p(this,C),this.EARTH=4007501668e-2,this.HALF_EARTH=2003750834e-2}project(t,e){return[w(this,C,G).call(this,t),w(this,C,V).call(this,e)]}unproject(t){return[w(this,C,X).call(this,t[0]),w(this,C,U).call(this,t[1])]}getID(){return"epsg:3857"}}C=new WeakSet,G=function(i){return i/180*this.HALF_EARTH},V=function(i){var t=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return t*this.HALF_EARTH/180},X=function(i){return i/this.HALF_EARTH*180},U=function(i){var t=i/this.HALF_EARTH*180;return t=180/Math.PI*(2*Math.atan(Math.exp(t*Math.PI/180))-Math.PI/2),t};var x,O,E,H,I,b,M,T,P,y,A,W,F,k,j;class at{constructor(t,e,n={},r=null){p(this,A),p(this,x),p(this,O),p(this,E),p(this,H),p(this,I),p(this,b),p(this,M),p(this,T),p(this,P),p(this,y),this.scene=t,this.camera=e,d(this,x,new tt),d(this,O,{}),d(this,E,null),d(this,H,0),d(this,I,100),d(this,b,null),this.setGpsOptions(n),d(this,M,null),d(this,T,0),d(this,P,0),d(this,y,r)}setProjection(t){d(this,x,t)}setGpsOptions(t={}){t.gpsMinDistance!==void 0&&d(this,H,t.gpsMinDistance),t.gpsMinAccuracy!==void 0&&d(this,I,t.gpsMinAccuracy)}async startGps(){if(s(this,y)){const t=await(await s(this,y).sendData("/gps/start",{gpsMinDistance:s(this,H),gpsMinAccuracy:s(this,I)})).json();d(this,P,t.session)}return s(this,b)===null?(d(this,b,navigator.geolocation.watchPosition(t=>{w(this,A,k).call(this,t)},t=>{s(this,O).gpserror?s(this,O).gpserror(t.code):alert(`GPS error: code ${t.code}`)},{enableHighAccuracy:!0})),!0):!1}stopGps(){return s(this,b)!==null?(navigator.geolocation.clearWatch(s(this,b)),d(this,b,null),!0):!1}fakeGps(t,e,n=null,r=0){n!==null&&this.setElevation(n),w(this,A,k).call(this,{coords:{longitude:t,latitude:e,accuracy:r}})}lonLatToWorldCoords(t,e){const n=s(this,x).project(t,e);if(s(this,M))n[0]-=s(this,M)[0],n[1]-=s(this,M)[1];else throw"No initial position determined";return[n[0],-n[1]]}add(t,e,n,r,u={}){var m;t.properties=u,w(this,A,W).call(this,t,e,n,r),this.scene.add(t),(m=s(this,y))==null||m.sendData("/object/new",{position:t.position,x:t.position.x,z:t.position.z,session:s(this,P),properties:u})}setElevation(t){this.camera.position.y=t}on(t,e){s(this,O)[t]=e}}x=new WeakMap,O=new WeakMap,E=new WeakMap,H=new WeakMap,I=new WeakMap,b=new WeakMap,M=new WeakMap,T=new WeakMap,P=new WeakMap,y=new WeakMap,A=new WeakSet,W=function(i,t,e,n){const r=this.lonLatToWorldCoords(t,e);n!==void 0&&(i.position.y=n),[i.position.x,i.position.z]=r},F=function(i,t){d(this,M,s(this,x).project(i,t))},k=function(i){var t,e,n;let r=Number.MAX_VALUE;J(this,T)._++,(t=s(this,y))==null||t.sendData("/gps/new",{gpsCount:s(this,T),lat:i.coords.latitude,lon:i.coords.longitude,acc:i.coords.accuracy,session:s(this,P)}),i.coords.accuracy<=s(this,I)&&(s(this,E)===null?d(this,E,{latitude:i.coords.latitude,longitude:i.coords.longitude}):r=w(this,A,j).call(this,s(this,E),i.coords),r>=s(this,H)&&(s(this,E).longitude=i.coords.longitude,s(this,E).latitude=i.coords.latitude,s(this,M)||(w(this,A,F).call(this,i.coords.longitude,i.coords.latitude),(e=s(this,y))==null||e.sendData("/worldorigin/new",{gpsCount:s(this,T),lat:i.coords.latitude,lon:i.coords.longitude,session:s(this,P),initialPosition:s(this,M)})),w(this,A,W).call(this,this.camera,i.coords.longitude,i.coords.latitude),(n=s(this,y))==null||n.sendData("/gps/accepted",{gpsCount:s(this,T),cameraX:this.camera.position.x,cameraZ:this.camera.position.z,session:s(this,P),distMoved:r}),s(this,O).gpsupdate&&s(this,O).gpsupdate(i,r)))},j=function(i,t){const e=g.degToRad(t.longitude-i.longitude),n=g.degToRad(t.latitude-i.latitude),r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(g.degToRad(i.latitude))*Math.cos(g.degToRad(t.latitude))*(Math.sin(e/2)*Math.sin(e/2));return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371e3};class rt{constructor(t,e){this.sceneWebcam=new Y,this.initCamera(t,e)}async initCamera(t,e){let n;if(t?n=document.querySelector(t):(n=document.createElement("video"),n.setAttribute("autoplay",!0),n.setAttribute("playsinline",!0),n.style.display="none",document.body.appendChild(n)),this.texture=new Q(n),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){const r={video:{width:{ideal:(e==null?void 0:e.width)||1280},height:{ideal:(e==null?void 0:e.height)||720},facingMode:"environment"}};try{const u=await navigator.mediaDevices.getUserMedia(r);n.addEventListener("loadedmetadata",()=>{console.log("using the webcam successfully..."),n.setAttribute("width",n.videoWidth),n.setAttribute("height",n.videoHeight),n.play(),e.onVideoStarted(this.texture)}),n.srcObject=u}catch(u){setTimeout(()=>{alert(`Webcam Error
Name: `+u.name+`
Message: `+u.message)},1e3)}}else setTimeout(()=>{alert("sorry - media devices API not supported")},1e3)}dispose(){this.texture.dispose()}}const S=navigator.userAgent.match(/iPhone|iPad|iPod/i)||/Macintosh/i.test(navigator.userAgent)&&navigator.maxTouchPoints!=null&&navigator.maxTouchPoints>1,et=new Z(0,0,1),q=new z,it=new L,nt=new L(-Math.sqrt(.5),0,0,Math.sqrt(.5)),st={type:"change"};class ht extends K{constructor(t){super(),window.isSecureContext===!1&&console.error("THREE.DeviceOrientationControls: DeviceOrientationEvent is only available in secure contexts (https)");const e=this,n=1e-6,r=new L;this.object=t,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation=null,this.screenOrientation=0,this.alphaOffset=0,this.initialOffset=null,this.TWO_PI=2*Math.PI,this.HALF_PI=.5*Math.PI,this.orientationChangeEventName="ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation",this.smoothingFactor=1;const u=function({alpha:o,beta:h,gamma:c,webkitCompassHeading:a}){if(S){const l=360-a;e.alphaOffset=g.degToRad(l-o),e.deviceOrientation={alpha:o,beta:h,gamma:c,webkitCompassHeading:a}}else o<0&&(o+=360),e.deviceOrientation={alpha:o,beta:h,gamma:c};window.dispatchEvent(new CustomEvent("camera-rotation-change",{detail:{cameraRotation:t.rotation}}))},m=function(){e.screenOrientation=window.orientation||0},R=function(o,h,c,a,l){q.set(c,h,-a,"YXZ"),o.setFromEuler(q),o.multiply(nt),o.multiply(it.setFromAxisAngle(et,-l))};this.connect=function(){m(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&(window.addEventListener("orientationchange",m),window.addEventListener(e.orientationChangeEventName,u))}).catch(function(o){console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",o)}):(window.addEventListener("orientationchange",m),window.addEventListener(e.orientationChangeEventName,u)),e.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",m),window.removeEventListener(e.orientationChangeEventName,u),e.enabled=!1,e.initialOffset=!1,e.deviceOrientation=null},this.update=function({theta:o=0}={theta:0}){if(e.enabled===!1)return;const h=e.deviceOrientation;if(h){let c=h.alpha?g.degToRad(h.alpha)+e.alphaOffset:0,a=h.beta?g.degToRad(h.beta):0,l=h.gamma?g.degToRad(h.gamma):0;const D=e.screenOrientation?g.degToRad(e.screenOrientation):0;if(S){const v=new L;R(v,c,a,l,D);const f=new z().setFromQuaternion(v,"YXZ");console.log(f.x,f.y,f.z),f.y=g.degToRad(360-h.webkitCompassHeading),v.setFromEuler(f),e.object.quaternion.copy(v)}else{if(this.smoothingFactor<1){if(this.lastOrientation){const v=this.smoothingFactor;c=this._getSmoothedAngle(c,this.lastOrientation.alpha,v),a=this._getSmoothedAngle(a+Math.PI,this.lastOrientation.beta,v),l=this._getSmoothedAngle(l+this.HALF_PI,this.lastOrientation.gamma,v,Math.PI)}else a+=Math.PI,l+=this.HALF_PI;this.lastOrientation={alpha:c,beta:a,gamma:l}}R(e.object.quaternion,c+o,this.smoothingFactor<1?a-Math.PI:a,this.smoothingFactor<1?l-this.HALF_PI:l,D)}8*(1-r.dot(e.object.quaternion))>n&&(r.copy(e.object.quaternion),e.dispatchEvent(st))}},this._orderAngle=function(o,h,c=this.TWO_PI){return h>o&&Math.abs(h-o)<c/2||o>h&&Math.abs(h-o)>c/2?{left:o,right:h}:{left:h,right:o}},this._getSmoothedAngle=function(o,h,c,a=this.TWO_PI){const l=this._orderAngle(o,h,a),D=l.left,v=l.right;l.left=0,l.right-=D,l.right<0&&(l.right+=a);let f=v==h?(1-c)*l.right+c*l.left:c*l.right+(1-c)*l.left;return f+=D,f>=a&&(f-=a),f},this.updateAlphaOffset=function(){e.initialOffset=!1},this.dispose=function(){e.disconnect()},this.getAlpha=function(){const{deviceOrientation:o}=e;return o&&o.alpha?g.degToRad(o.alpha)+e.alphaOffset:0},this.getBeta=function(){const{deviceOrientation:o}=e;return o&&o.beta?g.degToRad(o.beta):0},window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?this.initPermissionDialog():this.connect()}initPermissionDialog(){const t=document.createElement("div"),e=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div");document.body.appendChild(t);const u={display:"flex",position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1,backgroundColor:"rgba(0,0,0,0.6)",justifyContent:"center",alignItems:"center"},m={backgroundColor:"white",padding:"6px",borderRadius:"3px",width:"36rem",height:"24rem"},R={width:"100%",height:"70%",display:"flex",justifyContent:"center",alignItems:"center"},o={display:"inline-flex",width:"100%",height:"30%",justifyContent:"center",alignItems:"center"};for(let a in u)t.style[a]=u[a];for(let a in m)e.style[a]=m[a];for(let a in R)n.style[a]=R[a];for(let a in o)r.style[a]=o[a];t.appendChild(e),e.appendChild(n),e.appendChild(r),n.innerHTML='<div style="font-size: 24pt; margin: 1rem;">This immersive website requires access to your device motion sensors.</div>';const h=()=>{this.connect(),t.style.display="none"},c=document.createElement("button");c.addEventListener("click",h),c.style.width="50%",c.style.height="80%",c.style.fontSize="20pt",c.appendChild(document.createTextNode("OK")),r.appendChild(c),document.body.appendChild(t)}}class ct{constructor(t){this.raycaster=new $,this.normalisedMousePosition=new B(null,null),t.domElement.addEventListener("click",e=>{this.normalisedMousePosition.set(e.clientX/t.domElement.clientWidth*2-1,-(e.clientY/t.domElement.clientHeight*2)+1)})}raycast(t,e){if(this.normalisedMousePosition.x!==null&&this.normalisedMousePosition.y!==null){this.raycaster.setFromCamera(this.normalisedMousePosition,t);const n=this.raycaster.intersectObjects(e.children,!1);return this.normalisedMousePosition.set(null,null),n}return[]}}export{ht as a,rt as o,ct as r,at as s};
